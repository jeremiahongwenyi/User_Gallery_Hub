name: CI Pipeline

on:
  push:
    branches:
      - main
      - jeremiah
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Check out the code
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: "20" # Changed to 20 as Node 22 is still in development
          cache: "npm" # Added caching for faster builds

      - name: Install dependencies
        run: |
          npm ci  # Changed to ci for cleaner installs in CI environment

      # Added Puppeteer dependencies
      - name: Install Puppeteer Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y libgbm-dev

      - name: Run Linter
        run: npm run lint

      - name: Setup Chrome
        uses: browser-actions/setup-chrome@latest
        with:
          chrome-version: stable

      # Added Chrome configuration check
      - name: Check Chrome Configuration
        run: |
          google-chrome --version
          which google-chrome

      # Modified test command with additional flags
      - name: Run Tests
        run: |
          npm run test -- --no-watch --no-progress
        env:
          CHROME_BIN: /usr/bin/google-chrome

      # Optional: Added build step if you want to ensure the project builds successfully
      - name: Build
        run: npm run build -- --configuration production
